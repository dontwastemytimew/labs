#pragma once
#include <QString>
#include <QMap>
#include <QDateTime>
#include <QSet>

/**
 * @class Note
 * @brief Модель даних для однієї нотатки.
 *
 * Цей клас є основним контейнером даних. Він зберігає всю інформацію,
 * що стосується однієї нотатки: її заголовок, прив'язку до схеми (шаблону),
 * динамічні поля з даними, теги, дату створення.
 *
 * Також клас підтримує розширені можливості:
 * - Збереження зображень (у форматі Base64).
 * - Статус "Закріплено" (Pinned) для пріоритетного відображення у списку.
 */
class Note {
public:
    /**
     * @brief Конструктор класу Note.
     * * Створює нову нотатку із заданим заголовком та схемою.
     * Дата створення встановлюється автоматично на поточний момент часу.
     * За замовчуванням нотатка не є закріпленою і не містить зображення.
     *
     * @param title Назва (заголовок) нової нотатки.
     * @param schemaId Ідентифікатор (індекс) схеми, за якою створюється нотатка.
     */
    Note(const QString& title, int schemaId);

    /**
     * @brief Додає нове поле з даними до нотатки.
     * * Використовується для заповнення динамічних полів, визначених у схемі.
     *
     * @param name Назва поля (має відповідати назві поля у схемі, наприклад "Інгредієнти").
     * @param value Значення, яке ввів користувач (наприклад, "Картопля, морква").
     */
    void addField(const QString& name, const QString& value);

    /**
     * @brief Повертає назву нотатки.
     * @return QString, що містить заголовок нотатки.
     */
    QString getTitle() const;

    /**
     * @brief Повертає ID схеми, до якої належить нотатка.
     * * Цей ID використовується для того, щоб знати, які поля має відображати
     * редактор і до якої категорії належить нотатка при побудові статистики.
     *
     * @return int Ідентифікатор (індекс) схеми.
     */
    int getSchemaId() const;

    /**
     * @brief Повертає мапу всіх полів та їх значень.
     * @return Константне посилання на QMap, де ключ — це назва поля, а значення — вміст поля.
     */
    const QMap<QString, QString>& getFields() const;

    /**
     * @brief Повертає дату та час створення нотатки.
     * @return QDateTime об'єкт, що зберігає момент створення.
     */
    QDateTime getCreationDate() const;

    /**
     * @brief Додає один новий тег до нотатки.
     * * Тег автоматично очищується від зайвих пробілів. Якщо такий тег вже існує,
     * він не буде доданий повторно (використовується QSet).
     *
     * @param tag Текст тега для додавання (наприклад, "важливо").
     */
    void addTag(const QString& tag);

    /**
     * @brief Повертає набір усіх тегів, що належать до нотатки.
     * @return Константне посилання на QSet<QString> з унікальними тегами.
     */
    const QSet<QString>& getTags() const;

    /**
     * @brief Повністю замінює набір тегів нотатки.
     * * Використовується при редагуванні нотатки, коли користувач змінює список тегів.
     * Старий набір тегів видаляється і замінюється новим.
     *
     * @param tags Новий набір тегів (QSet).
     */
    void setTags(const QSet<QString>& tags);

    /**
     * @brief Встановлює нову назву для нотатки.
     * @param title Новий рядок заголовка.
     */
    void setTitle(const QString& title);

    /**
     * @brief Зберігає зображення у нотатці.
     *
     * @details Зображення зберігається не як файл на диску, а як закодований
     * текстовий рядок у форматі Base64. Це дозволяє зберігати картинку
     * безпосередньо всередині JSON-файлу бази даних разом з текстом (Embedded Image).
     *
     * @param base64Image Рядок, що містить бінарні дані зображення, закодовані в Base64.
     */
    void setImage(const QString& base64Image);

    /**
     * @brief Отримує збережене зображення.
     *
     * @details Повертає рядок у форматі Base64. Для відображення в інтерфейсі
     * цей рядок необхідно декодувати назад у QByteArray і завантажити в QPixmap.
     * Якщо зображення не було встановлено, повертає порожній рядок.
     *
     * @return QString з даними зображення або порожній рядок.
     */
    QString getImage() const;

    /**
     * @brief Перевіряє, чи є нотатка "Закріпленою" (Вибраною).
     *
     * Закріплені нотатки мають пріоритет при сортуванні (відображаються зверху списку)
     * і позначаються спеціальною іконкою (зірочкою) в інтерфейсі.
     *
     * @return true, якщо нотатка закріплена, інакше false.
     */
    bool isPinned() const;

    /**
     * @brief Встановлює статус закріплення нотатки.
     *
     * Зміна цього статусу впливає на порядок сортування нотаток у головному списку.
     *
     * @param pinned true для закріплення, false для відкріплення.
     */
    void setPinned(bool pinned);

 /**
     * @brief Встановлює дату створення нотатки.
     *
     * Використовується переважно для десеріалізації (завантаження з JSON) та тестування.
     * @param date Нова дата та час створення.
     */
 void setCreationDate(const QDateTime& date);

private:
    QString m_title;                ///< Назва нотатки.
    int m_schemaId;                 ///< ID схеми, за якою створено нотатку.
    QMap<QString, QString> m_fields;///< Дані полів у форматі "Назва поля" -> "Значення".
    QDateTime m_creationDate;       ///< Дата та час створення нотатки.
    QSet<QString> m_tags;           ///< Набір унікальних тегів.
    QString m_imageBase64;          ///< Зображення, закодоване у рядок формату Base64.
    bool m_isPinned = false;        ///< Прапорець статусу "Закріплено" (за замовчуванням false).
};